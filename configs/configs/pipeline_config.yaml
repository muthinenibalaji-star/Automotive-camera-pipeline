# Automotive Camera Pipeline Configuration
# Updated with Detection Module (RTMDet) and State Estimation

# System Settings
system:
  num_cameras: 1
  target_fps: 30
  max_latency_ms: 100
  gpu_device: 0
  log_level: INFO

# Camera Settings
cameras:
  camera_0:
    source_type: "usb"  # Options: usb, dataset, industrial
    source: 0           # Device index or path
    width: 1920
    height: 1080
    fps: 30

# ============================================
# DETECTION CONFIGURATION (NEW)
# ============================================
detection:
  # Backend selection
  backend: rtmdet          # Currently: rtmdet (future: yolo, etc.)
  
  # Device settings
  device: cuda             # cuda | cpu
  fp16: true               # Enable FP16 inference (CUDA only)
  
  # Model configuration
  model:
    variant: s             # s | m (RTMDet-S or RTMDet-M)
    
    # Model files (adjust paths to your setup)
    config_path: "models/rtmdet/configs/rtmdet_s_automotive_lights.py"
    weights_path: "models/rtmdet/weights/rtmdet_s_lights_epoch_300.pth"
    
    # Input size (width, height)
    input_size: [1280, 720]
    
    # Class names (order must match training)
    class_names:
      - "left_indicator"
      - "right_indicator"
      - "brake_light"
      - "reverse_light"
      - "headlight"
      - "fog_light"
      - "tail_light"
      - "hazard_light"
  
  # Detection thresholds
  thresholds:
    score: 0.4              # Confidence threshold
    nms: 0.45               # NMS IoU threshold
    max_detections: 100     # Maximum detections per frame

# Tracking Configuration
tracking:
  method: "bytetrack"
  track_thresh: 0.5
  track_buffer: 30
  match_thresh: 0.8
  min_box_area: 100

# ============================================
# STATE ESTIMATION CONFIGURATION
# ============================================
state_estimation:
  enabled: true
  
  # Temporal window
  window_size: 60  # frames (2 sec at 30 FPS)
  
  # State thresholds
  on_threshold: 0.5
  off_threshold: 0.2
  
  # Blink detection
  blink_detection:
    min_frequency: 0.5   # Hz
    max_frequency: 3.0   # Hz
    min_cycles: 2
    variance_threshold: 0.3
  
  # Confidence parameters
  confidence:
    gain: 0.1
    decay: 0.05
    reset_value: 0.3
    min_threshold: 0.6
  
  # State transitions
  transition:
    debounce_frames: 5
  
  # Track management
  cleanup:
    stale_threshold: 5.0  # seconds

# ============================================
# VISUALIZATION CONFIGURATION
# ============================================
visualization:
  enabled: true
  
  # Display options
  display:
    show_labels: true
    show_confidence: true
    show_frequency: true
    show_info_panel: true
  
  # Rendering options
  rendering:
    box_thickness: 2
    font_scale: 0.5
    font_thickness: 1
  
  # Save options
  save_annotated_frames: false
  save_frame_interval: 30

# ============================================
# DEBUG CONFIGURATION
# ============================================
debug:
  enabled: false
  
  # State timeline plots
  state_plots:
    enabled: false
    output_dir: "debug_plots"
    save_interval: 300
  
  # Frequency analysis
  frequency_analysis:
    enabled: false
    output_dir: "debug_plots/frequency"
  
  # Validation reports
  validation_report:
    enabled: false
    output_dir: "debug_plots/reports"
    generate_interval: 1000
  
  # Detection visualization
  detection_debug:
    enabled: false
    save_detections: false
    output_dir: "debug_plots/detections"

# ============================================
# OUTPUT CONFIGURATION
# ============================================
output:
  format: "json"
  include_timestamps: true
  output_directory: "data/output"
  
  # Output fields
  include_detection_info: true
  include_state_info: true
  include_confidence: true
  include_activation_ratio: true
  
  # Logging
  log_frames: false
  save_visualizations: true
  visualization_directory: "data/output/visualizations"

# ============================================
# PERFORMANCE CONFIGURATION
# ============================================
performance:
  batch_size: 1            # Real-time: batch_size = 1
  num_workers: 2
  prefetch_frames: 3
  enable_profiling: false
  
  # Latency budgets (ms)
  max_detection_latency: 30
  max_tracking_latency: 15
  max_state_estimation_latency: 5
  max_total_latency: 100

# ============================================
# MODEL SWITCHING EXAMPLES
# ============================================
# To switch from RTMDet-S to RTMDet-M:
# detection:
#   model:
#     variant: m
#     config_path: "models/rtmdet/configs/rtmdet_m_automotive_lights.py"
#     weights_path: "models/rtmdet/weights/rtmdet_m_lights_epoch_300.pth"

# To use CPU instead of GPU:
# detection:
#   device: cpu
#   fp16: false
